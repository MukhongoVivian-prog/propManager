{% extends 'base.html' %}
{% load static %}
{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 col-lg-2 p-0">
      {% include 'tenant_sidebar.html' %}
    </div>
    <!-- Main Content -->
    <div class="col-md-9 col-lg-10 py-4 px-4">
      <h2 class="fw-bold mb-1">My Bookings</h2>
      <div class="text-muted mb-4">Track your property bookings and reservations</div>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}

      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-semibold mb-3">Booking History</h5>
          {% if bookings %}
            <div class="table-responsive">
              <table class="table table-hover">
                <thead class="table-light">
                  <tr>
                    <th>Property</th>
                    <th>Landlord</th>
                    <th>Date</th>
                    <th>Price</th>
                    <th>Status</th>
                    <th>Payment</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  {% for booking in bookings %}
                  <tr>
                    <td>
                      <div class="d-flex align-items-center">
                        {% if booking.property.images.first %}
                          <img src="{{ booking.property.images.first.image.url }}" class="rounded me-2" style="width: 40px; height: 40px; object-fit: cover;">
                        {% else %}
                          <img src="https://via.placeholder.com/40x40?text=No+Image" class="rounded me-2" style="width: 40px; height: 40px; object-fit: cover;">
                        {% endif %}
                        <div>
                          <strong>{{ booking.property.title }}</strong><br>
                          <small class="text-muted">{{ booking.property.location }}</small>
                        </div>
                      </div>
                    </td>
                    <td>
                      {{ booking.property.landlord.first_name }} {{ booking.property.landlord.last_name }}<br>
                      <small class="text-muted">{{ booking.property.landlord.email }}</small>
                    </td>
                    <td>{{ booking.date }}</td>
                    <td>${{ booking.price }}</td>
                    <td>
                      {% if booking.status == 'pending' %}
                        <span class="badge bg-warning text-dark">Pending Approval</span>
                      {% elif booking.status == 'approved' %}
                        <span class="badge bg-info">Approved</span>
                      {% elif booking.status == 'payment_pending' %}
                        <span class="badge bg-warning text-dark">Payment Pending</span>
                      {% elif booking.status == 'payment_completed' %}
                        <span class="badge bg-success">Payment Completed</span>
                      {% elif booking.status == 'checked_in' %}
                        <span class="badge bg-primary">Checked In</span>
                      {% elif booking.status == 'completed' %}
                        <span class="badge bg-secondary">Completed</span>
                      {% elif booking.status == 'cancelled' %}
                        <span class="badge bg-danger">Cancelled</span>
                      {% endif %}
                    </td>
                    <td>
                      {% if booking.payment_status == 'pending' %}
                        <span class="badge bg-warning text-dark">Pending</span>
                      {% elif booking.payment_status == 'processing' %}
                        <span class="badge bg-info">Processing</span>
                      {% elif booking.payment_status == 'completed' %}
                        <span class="badge bg-success">Completed</span>
                      {% elif booking.payment_status == 'failed' %}
                        <span class="badge bg-danger">Failed</span>
                      {% endif %}
                    </td>
                    <td>
                      <div class="btn-group" role="group">
                        {% if booking.status == 'pending' %}
                          <span class="text-muted">Waiting for landlord approval</span>
                        {% elif booking.status == 'approved' %}
                          <a href="{% url 'payment_page' booking.id %}" class="btn btn-sm btn-primary">
                            <i class="bi bi-credit-card me-1"></i>Pay Now
                          </a>
                        {% elif booking.status == 'payment_completed' %}
                          <a href="{% url 'checkin_booking' booking.id %}" class="btn btn-sm btn-success">
                            <i class="bi bi-box-arrow-in-right me-1"></i>Check In
                          </a>
                        {% elif booking.status == 'checked_in' %}
                          <span class="text-success"><i class="bi bi-check-circle me-1"></i>Checked In</span>
                        {% endif %}
                        <a href="{% url 'property_detail' booking.property.id %}" class="btn btn-sm btn-outline-primary">
                          <i class="bi bi-eye"></i>
                        </a>
                      </div>
                    </td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          {% else %}
            <div class="text-center py-4">
              <i class="bi bi-calendar-x fs-1 text-muted"></i>
              <h5 class="mt-3">No bookings yet</h5>
              <p class="text-muted">Start by browsing available properties and making your first booking!</p>
              <a href="{% url 'browse_properties' %}" class="btn btn-primary">
                <i class="bi bi-search me-2"></i>Browse Properties
              </a>
            </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 