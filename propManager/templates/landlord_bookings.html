{% extends 'base.html' %}
{% block content %}
<div class="container-fluid">
  <div class="row">
    <!-- Sidebar -->
    <div class="col-md-2 col-lg-2 p-0">
      {% include 'sidebar/landlord_sidebar.html' %}
    </div>
    <!-- Main Content -->
    <div class="col-md-10 col-lg-10 py-4 px-4">
      <div class="d-flex justify-content-between align-items-center mb-3">
        <h2 class="fw-bold mb-1">Bookings for My Properties</h2>
        <form method="get" class="d-flex align-items-center">
          <label for="status" class="me-2 mb-0">Filter by Status:</label>
          <select name="status" id="status" class="form-select form-select-sm me-2" onchange="this.form.submit()">
            <option value="">All</option>
            <option value="pending" {% if status_filter == 'pending' %}selected{% endif %}>Pending</option>
            <option value="approved" {% if status_filter == 'approved' %}selected{% endif %}>Approved</option>
            <option value="payment_pending" {% if status_filter == 'payment_pending' %}selected{% endif %}>Payment Pending</option>
            <option value="payment_completed" {% if status_filter == 'payment_completed' %}selected{% endif %}>Payment Completed</option>
            <option value="reserved" {% if status_filter == 'reserved' %}selected{% endif %}>Reserved</option>
            <option value="checked_in" {% if status_filter == 'checked_in' %}selected{% endif %}>Checked In</option>
            <option value="completed" {% if status_filter == 'completed' %}selected{% endif %}>Completed</option>
            <option value="cancelled" {% if status_filter == 'cancelled' %}selected{% endif %}>Cancelled</option>
          </select>
        </form>
      </div>
      <div class="card shadow-sm">
        <div class="card-body">
          <h5 class="card-title fw-semibold mb-4">All Bookings</h5>
          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-success">{{ message }}</div>
            {% endfor %}
          {% endif %}
          <div class="table-responsive">
            <table class="table align-middle mb-0">
              <thead>
                <tr>
                  <th>Property</th>
                  <th>Tenant</th>
                  <th>Date</th>
                  <th>Status</th>
                  <th>Price</th>
                  <th>Created</th>
                  <th>Payment</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for booking in bookings %}
                <tr>
                  <td>{{ booking.property.title }}</td>
                  <td>{{ booking.tenant.first_name }} {{ booking.tenant.last_name }}<br><small>{{ booking.tenant.email }}</small></td>
                  <td>{{ booking.date }}</td>
                  <td>
                    <div class="btn-group" role="group">
                      {% if booking.status == 'pending' %}
                        <a href="{% url 'landlord_approve_booking' booking.id %}" class="btn btn-sm btn-success">
                          <i class="bi bi-check-circle me-1"></i>Approve
                        </a>
                        <button class="btn btn-sm btn-danger">
                          <i class="bi bi-x-circle me-1"></i>Reject
                        </button>
                      {% elif booking.status == 'approved' %}
                        <span class="text-success"><i class="bi bi-check-circle me-1"></i>Approved</span>
                      {% elif booking.status == 'payment_completed' %}
                        <span class="text-primary"><i class="bi bi-credit-card me-1"></i>Payment Received</span>
                      {% elif booking.status == 'checked_in' %}
                        <span class="text-success"><i class="bi bi-box-arrow-in-right me-1"></i>Checked In</span>
                      {% endif %}
                      <a href="{% url 'property_detail' booking.property.id %}" class="btn btn-sm btn-outline-primary">
                        <i class="bi bi-eye"></i>
                      </a>
                    </div>
                  </td>
                  <td>${{ booking.price }}/month</td>
                  <td>{{ booking.created_at|date:'Y-m-d H:i' }}</td>
                  <td>
                    {% if booking.payment_status == 'pending' %}
                      <span class="badge bg-warning text-dark">Pending</span>
                    {% elif booking.payment_status == 'processing' %}
                      <span class="badge bg-info">Processing</span>
                    {% elif booking.payment_status == 'completed' %}
                      <span class="badge bg-success">Completed</span>
                    {% elif booking.payment_status == 'failed' %}
                      <span class="badge bg-danger">Failed</span>
                    {% endif %}
                  </td>
                  <td>
                    <a href="#" class="btn btn-light btn-sm" title="View Details"><i class="bi bi-eye"></i></a>
                    {% if booking.status == 'pending' %}
                    <form method="post" style="display:inline;">
                      {% csrf_token %}
                      <input type="hidden" name="booking_id" value="{{ booking.id }}">
                      <button type="submit" name="action" value="approve" class="btn btn-success btn-sm">Approve</button>
                      <button type="submit" name="action" value="reject" class="btn btn-danger btn-sm">Reject</button>
                    </form>
                    {% endif %}
                  </td>
                </tr>
                {% empty %}
                <tr>
                  <td colspan="6" class="text-center text-muted">No bookings found.</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} 